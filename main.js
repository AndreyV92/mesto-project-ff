(()=>{"use strict";function t(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n&&(e.classList.remove(o),n.classList.remove("popup__error_visible"),n.textContent="")}function e(e,o){Array.from(e.querySelectorAll(".popup__input")).forEach((function(n){t(e,n,o)}))}function o(t,o){e(t,o.inputErrorClass);var n=t.querySelector(o.submitButtonSelector);n.disabled=!0,n.classList.add(o.inactiveButtonClass)}function n(e,o,n){o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?t(e,o,n):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));r&&(e.classList.add(n),r.textContent=o,r.classList.add("popup__error_visible"))}(e,o,o.validationMessage,n)}function r(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(o)):(e.disabled=!0,e.classList.add(o))}function c(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e,o,c,u){var a=Array.from(t.querySelectorAll(e)),i=t.querySelector(o);r(a,i,u),a.forEach((function(e){e.addEventListener("input",(function(){n(t,e,c),r(a,i,u)}))}))}(e,t.inputSelector,t.submitButtonSelector,t.inputErrorClass,t.inactiveButtonClass)}))}function u(t){t&&(t.classList.contains("popup_is-opened")||t.classList.add("popup_is-opened")),document.addEventListener("keyup",i)}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keyup",i),e(t)}function i(t){"Escape"===t.key&&a(document.querySelector(".popup_is-opened"))}function p(t,e,o,n,r,c){var a=r.querySelector(".places__item").cloneNode(!0);if(a.querySelector(".card__image").src=t.link,a.querySelector(".card__image").name=t.name,a.querySelector(".card__title").textContent=t.name,t.likes?a.querySelector(".card__like-counter").textContent=t.likes.length:a.querySelector(".card__like-counter").textContent="",a.setAttribute("data-id",t._id),c){var i=a.querySelector(".card__delete-button");i&&i.addEventListener("click",(function(t){var o=document.querySelector(".popup_type_delete");u(o),o.querySelector(".popup__button_delete").addEventListener("click",(function(){e(t.target.closest(".places__item"),o)}))}))}else{var p=a.querySelector(".card__delete-button");p&&p.remove()}var s=a.querySelector(".card__image");s&&s.addEventListener("click",(function(){o(t)}));var l=a.querySelector(".card__like-button");return l&&l.addEventListener("click",(function(t){n(t.target)})),a}function s(t,e){if(t&&e&&t.querySelector(".card__delete-button")){var o=t.getAttribute("data-id"),n=e.querySelector(".popup__button_delete");n&&(n.removeEventListener("click",(function(){})),n.addEventListener("click",(function(){fetch("https://nomoreparties.co/v1/wff-cohort-33/cards/".concat(o),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"}}).then((function(o){o.ok&&(t.remove(),a(e))})).catch((function(t){console.error(t)}))})))}}function l(t,e){return e.prepend(t),t}function d(t){var e=t.closest(".places__item"),o=e.getAttribute("data-id");t.classList.contains("card__like-button_is-active")?function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-33/cards/likes/".concat(t),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"}}).then((function(t){return t?t.json():Promise.reject(t.status)}))}(o).then((function(o){t.classList.remove("card__like-button_is-active"),e.querySelector(".card__like-counter").textContent=o.likes.length})).catch((function(t){console.error(t)})):function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-33/cards/likes/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"}}).then((function(t){return t?t.json():Promise.reject(t.status)}))}(o).then((function(o){t.classList.add("card__like-button_is-active"),e.querySelector(".card__like-counter").textContent=o.likes.length})).catch((function(t){console.error(t)}))}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=Array(e);o<e;o++)n[o]=t[o];return n}var f,m,y=document.querySelector(".content").querySelector(".places__list"),b=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),h=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector('form[name="edit-profile"]'),C=S.querySelector('form[name="new-place"]'),k=C.querySelector(".popup__input_type_card-name"),E=C.querySelector(".popup__input_type_url"),L=document.querySelector(".popup__input_type_name"),g=document.querySelector(".popup__input_type_description"),A=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),B=(document.querySelector(".profile__image_edit"),document.querySelector(".popup_type_avatar")),T=B.querySelector(".popup__input_type_avatar"),w=B.querySelector(".popup__form"),D=document.querySelector(".popup_type_delete");function P(t){var e=document.querySelector(".popup_type_image");e.querySelector(".popup__image").src=t.link,e.querySelector(".popup__image").name=t.name,e.querySelector(".popup__caption").textContent=t.name,u(e)}x.addEventListener("click",(function(){u(B)})),f=w,(m=T).addEventListener("input",(function(){n(f,m,"popup__input_type_error"),r([m],f.querySelector(".popup__button"),"popup__button_disabled")})),w.addEventListener("submit",(function(t){t.preventDefault();var e=w.querySelector(".popup__button");e.textContent="Сохранение...",e.disabled=!0;var o=T.value;fetch("https://nomoreparties.co/v1/wff-cohort-33/users/me/avatar",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"},body:JSON.stringify({avatar:"https://yandex.ru/images/search?text=фотография+студента+мультяшного&pos=15&rpt=simage&img_url=https%3A%2F%2Fsun1-24.userapi.com%2Fs%2Fv1%2Fif1%2FOYDYbajaGGM4ZzBD7MHgxMNkBLbCl92YJASfkXcYNa9uQ97Xy5DsVAcmaHZdAtA9J_P8f38U.jpg%3Fsize%3D748x1080%26quality%3D96%26crop%3D0%2C0%2C748%2C1080%26ava%3D1&from=tabbar&lr=65"})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.error(t)})).then((function(t){x.style.backgroundImage="url(".concat(o,")"),a(B),e.textContent="Сохранить",e.disabled=!1})).catch((function(t){console.error(t),e.textContent="Сохранить",e.disabled=!1}))})),b.addEventListener("click",(function(){L.value=A.textContent,g.value=j.textContent,o(q,{inputErrorClass:"popup__input_type_error",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"}),u(v)})),q.addEventListener("submit",(function(t){t.preventDefault();var e=q.querySelector(".popup__button");e.textContent="Сохранение...",e.disabled=!0,fetch("https://nomoreparties.co/v1/wff-cohort-33/users/me",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"},body:JSON.stringify({name:"Andrey",about:"I am a student"})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){A.textContent=L.value,j.textContent=g.value,a(v),e.textContent="Сохранить",e.disabled=!1})).catch((function(t){console.error(t),e.textContent="Сохранить",e.disabled=!1}))})),h.addEventListener("click",(function(){u(S)})),c({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error"}),c({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),C.addEventListener("submit",(function(t){t.preventDefault();var e=C.querySelector(".popup__button");e.textContent="Сохранение...",e.disabled=!0;var n,r=k.value;(n={name:r,link:E.value,alt:r},fetch("https://nomoreparties.co/v1/wff-cohort-33/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"},body:JSON.stringify({name:n.name,link:n.link,alt:n.alt})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){var o=p(t,s,P,d,document.querySelector("#card-template").content);l(o,y),a(S),C.reset(),e.textContent="Сохранить",e.disabled=!1;var n=o.querySelector(".card__delete-button");n&&n.addEventListener("click",(function(t){var e=t.target.closest(".places__item");u(D),D.querySelector(".popup__button_delete").addEventListener("click",(function(){e&&s(e,D),a(D)}))}))})).catch((function(t){console.error(t),e.textContent="Сохранить",e.disabled=!1})),a(S),C.reset(),o(C,{inputErrorClass:"popup__input_type_error",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"})})),window.addEventListener("click",(function(t){t.target.classList.contains("popup")&&a(t.target)})),document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(){var e=t.closest(".popup");a(e),e===v?o(q,{inputErrorClass:"popup__input_type_error",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"}):e===S&&o(C,{inputErrorClass:"popup__input_type_error",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"})}))})),Promise.all([fetch("https://nomoreparties.co/v1/wff-cohort-33/users/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})),fetch("https://nomoreparties.co/v1/wff-cohort-33/cards",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"0ae5b52a-cf5b-4c64-a6ed-5b7a5c2cfd81"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))]).then((function(t){var e,o,n=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,c,u,a=[],i=!0,p=!1;try{if(c=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=c.call(o)).done)&&(a.push(n.value),a.length!==e);i=!0);}catch(t){p=!0,r=t}finally{try{if(!i&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(p)throw r}}return a}}(e,o)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],c=n[1];A.textContent=r.name,j.textContent=r.about,x.src=r.avatar,c.forEach((function(t){var e=t.owner._id===r._id,o=p(t,s,P,d,document.querySelector("#card-template").content,e);l(o,y);var n=o.querySelector(".card__delete-button");n&&n.addEventListener("click",(function(t){var e=t.target.closest(".places__item");u(D),D.querySelector(".popup__button_delete").addEventListener("click",(function(){e&&s(e),a(D)}))}))}))}))})();